<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WithdrawalController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MavenATMv2</a> &gt; <a href="index.source.html" class="el_package">controller</a> &gt; <span class="el_source">WithdrawalController.java</span></div><h1>WithdrawalController.java</h1><pre class="source lang-java linenums">package controller;

import static model.Constants.*;

import model.Transaction;
import model.Withdrawal;
import view.Keypad;
import view.Screen;

public class WithdrawalController extends TransactionController{

	public WithdrawalController(Transaction theTransaction, Keypad theKeypad, Screen theScreen) {
<span class="fc" id="L13">		super(theTransaction, theKeypad, theScreen);</span>
		// TODO Auto-generated constructor stub
<span class="fc" id="L15">	}</span>

	@Override
	public void run() {
		// TODO withdraw nominal from saldo account process 
<span class="nc" id="L20">		Withdrawal transaction = (Withdrawal) getTransaction();</span>
<span class="nc" id="L21">		Screen screen = getScreen(); // get screen reference</span>
		int idxamount;
		int statusProcess;   

		// loop while no valid choice has been made on withdrawal option menu
		do {
<span class="nc" id="L27">			idxamount = displayMenuOfAmounts();</span>
<span class="nc bnc" id="L28" title="All 2 branches missed.">			while (idxamount &lt;= 0) {</span>
<span class="nc bnc" id="L29" title="All 5 branches missed.">				switch (idxamount) {</span>
					case WITHDRAWAL_ERROR_POSITIVE_AMOUNT :
<span class="nc" id="L31">						screen.displayMessageLine(&quot;Value amount not valid, must be positif value&quot;);</span>
<span class="nc" id="L32">						break;</span>
					case WITHDRAWAL_ERROR_MULTIPLE_AMOUNT :
<span class="nc" id="L34">						screen.displayMessageLine(&quot;Value amount not a multiple of 20&quot;);</span>
<span class="nc" id="L35">						break;</span>
					case WITHDRAWAL_ERROR_RANGE_AMOUNT :
<span class="nc" id="L37">						screen.displayMessageLine(&quot;Invalid selection. Try again. the nominal amount withdrawal does not match the valid range &quot;</span>
								+ &quot;the transaction must be with minimum transaction is $&quot; + MIN_WITHDRAW_AMOUNT + &quot; and &quot;
								+ &quot;maximum transaction is $&quot; + MAX_WITHDRAW_AMOUNT);
<span class="nc" id="L40">						break;</span>
					case WITHDRAWAL_ERROR_INPUT_MENU :
<span class="nc" id="L42">						screen.displayMessageLine(&quot;Invalid selection. Try again!&quot;);</span>
						break;
						
				}   
<span class="nc" id="L46">			   idxamount = displayMenuOfAmounts();</span>
			}
			
<span class="nc" id="L49">			transaction.setAmount(idxamount);</span>
<span class="nc" id="L50">			statusProcess = transaction.execute();</span>
<span class="nc bnc" id="L51" title="All 5 branches missed.">			switch (statusProcess) {</span>
				case CASHDISPENSER_NOT_ENOUGH :
<span class="nc" id="L53">					screen.displayMessageLine(&quot;Cash dispenser doesn't have sufficient amount of cash&quot;);</span>
<span class="nc" id="L54">					break;</span>
				case BALANCE_NOT_ENOUGH :
<span class="nc" id="L56">					screen.displayMessageLine(&quot;Your balance isn't enough for this withdrawal&quot;);</span>
<span class="nc" id="L57">					break;</span>
				case WITHDRAWAL_CANCELED :
<span class="nc" id="L59">					screen.displayMessageLine(&quot;You canceled transaction&quot;);</span>
<span class="nc" id="L60">					break;</span>
				case WITHDRAW_SUCCESSFUL :
<span class="nc" id="L62">					screen.displayMessageLine(&quot;Your cash has been dispensed. Please take your cash now&quot;);</span>
					break;
					
			}
<span class="nc bnc" id="L66" title="All 2 branches missed.">		}while(statusProcess!=WITHDRAWAL_CANCELED);</span>
<span class="nc" id="L67">	}</span>
	
	// display a menu of withdrawal amounts and the option to cancel;
	// return the chosen amount or 0 if the user chooses to cancel
	// TODO private
	public int displayMenuOfAmounts() {
<span class="fc" id="L73">		int userChoice = 0; // local variable to store return value</span>

<span class="fc" id="L75">		Screen screen = getScreen(); // get screen reference</span>
	      
		// array of amounts to correspond to menu numbers
<span class="fc" id="L78">		int[] amounts = {0, 20, 40, 60, 100, 200};</span>

		// loop while no valid choice has been made
		//while (userChoice == 0) {
		// display the withdrawal menu
<span class="fc" id="L83">		screen.displayMessageLine(&quot;\nCash Withdrawal Menu:&quot;);</span>
<span class="fc" id="L84">		screen.displayMessageLine(&quot;1 - $20&quot;);</span>
<span class="fc" id="L85">		screen.displayMessageLine(&quot;2 - $40&quot;);</span>
<span class="fc" id="L86">		screen.displayMessageLine(&quot;3 - $60&quot;);</span>
<span class="fc" id="L87">		screen.displayMessageLine(&quot;4 - $100&quot;);</span>
<span class="fc" id="L88">		screen.displayMessageLine(&quot;5 - $200&quot;);</span>
<span class="fc" id="L89">		screen.displayMessageLine(&quot;6 - Other amount&quot;);</span>
<span class="fc" id="L90">		screen.displayMessageLine(&quot;7 - Cancel transaction&quot;);</span>
<span class="fc" id="L91">		screen.displayMessage(&quot;\nChoose option menu: &quot;);</span>

<span class="fc" id="L93">		int input = keypad.getInput(); // get user input through keypad</span>
		// determine how to proceed based on the input value
<span class="fc bfc" id="L95" title="All 4 branches covered.">		switch (input) {</span>
			case 1: // if the user chose a withdrawal amount 
			case 2: // (i.e., chose option 1, 2, 3, 4 or 5), return the
			case 3: // corresponding amount from amounts array
			case 4:
			case 5:
<span class="fc" id="L101">				userChoice = amounts[input]; // save user's choice</span>
<span class="fc" id="L102">				break;       </span>
	        case WITHDRAWAL_OTHER_AMOUNT: 
<span class="fc" id="L104">	        	screen.displayMessageLine(&quot;\nInput other amount in multiples of 20 :&quot;);</span>
<span class="fc" id="L105">	        	input = keypad.getInput();</span>
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">	        	if(!positifValidWithdrawAmount(input)) { //V1</span>
<span class="nc" id="L107">	        		userChoice = WITHDRAWAL_ERROR_POSITIVE_AMOUNT;</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">	        	}else if (!validWithdrawAmount(input)) { // V2</span>
<span class="fc" id="L109">	        		userChoice = WITHDRAWAL_ERROR_MULTIPLE_AMOUNT;</span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">	        	}else if (!rangeValidWithdrawAmount(input)) { // V3</span>
<span class="fc" id="L111">	        		userChoice = WITHDRAWAL_ERROR_RANGE_AMOUNT;</span>
	        	}else  {
<span class="fc" id="L113">	        		userChoice = input;</span>
	        	}
<span class="fc" id="L115">	        	break;</span>
	        case WITHDRAWAL_CANCELED: // the user chose to cancel
<span class="fc" id="L117">	        	userChoice = WITHDRAWAL_CANCELED; // save user's choice</span>
<span class="fc" id="L118">	        	break;</span>
	        default: // the user did not enter a value from 1-7
<span class="fc" id="L120">	        	userChoice = WITHDRAWAL_ERROR_INPUT_MENU;</span>
		} 
	      //} 

<span class="fc" id="L124">		return userChoice; // return withdrawal amount or CANCELED</span>
	}

	private boolean positifValidWithdrawAmount(int amount) {
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">		if(amount &gt; 0) {</span>
<span class="fc" id="L129">			return  true;</span>
		}else {
<span class="nc" id="L131">			return false;</span>
		}
	}
	
	// TODO PRIVATE
	public boolean validWithdrawAmount(int amount) {
<span class="fc bfc" id="L137" title="All 2 branches covered.">		if(amount % 20 == 0) {</span>
<span class="fc" id="L138">			return  true;</span>
		}else {
<span class="fc" id="L140">			return false;</span>
		}
	}
	
	// TODO PRIVATE
	public boolean rangeValidWithdrawAmount(int amount) {
<span class="fc bfc" id="L146" title="All 4 branches covered.">		if(amount&gt;= MIN_WITHDRAW_AMOUNT &amp;&amp; amount&lt;= MAX_WITHDRAW_AMOUNT) {</span>
<span class="fc" id="L147">			return  true;</span>
		}else {
<span class="fc" id="L149">			return false;</span>
		}
	}
	

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>